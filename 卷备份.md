# 卷备份（docker-volume-backup）

Tradis Client 端已集成 `offen/docker-volume-backup` 的“伴随容器”方案，用于对 Docker Volume 做定时/一次性备份。备份容器由系统托管：保存设置后自动拉取镜像、创建/重建容器，并将选中卷以只读方式挂载到容器 `/backup/<volume>`。

## 使用方式

1. 进入「系统设置」→「卷备份（docker-volume-backup）」。
2. 开启「启用卷定时备份」。
3. 选择需要备份的卷（可多选）。
4. （可选）填写「本地归档目录」以挂载到容器 `/archive` 保存本地副本。
5. 在「环境变量」中粘贴 `docker-volume-backup` 的配置（按行 `KEY=VALUE`），例如：

```text
BACKUP_CRON_EXPRESSION=0 3 * * *
BACKUP_FILENAME=backup-%Y-%m-%dT%H-%M-%S.tar.gz
```

保存后系统会在「消息中心」提示备份容器启用成功/失败原因。

## 环境变量说明

环境变量内容会原样注入到备份容器中，便于你直接套用 `offen/docker-volume-backup` 官方文档中的 `env_file` 配置。常见场景：

- **本地归档**：挂载 `/archive` 并配置归档路径相关变量
- **S3 兼容存储**：配置 `AWS_ACCESS_KEY_ID` / `AWS_SECRET_ACCESS_KEY` / `AWS_S3_BUCKET_NAME` 等
- **WebDAV / SSH / 其它后端**：按官方文档配置对应变量

建议把敏感变量（密钥、密码）仅写在此处，不要写入日志或截图。

## 运行行为

- 容器名固定为：`tradis-volume-backup`
- 启用时：若镜像不存在会先拉取；若已有同名容器会删除后重建
- 禁用时：会删除备份容器（不会删除任何卷/备份文件）
- 选中卷会以只读方式挂载到：`/backup/<volume>`
- 若开启「挂载 Docker Socket」会绑定：`/var/run/docker.sock:/var/run/docker.sock:ro`

## Docker Compose 参考

如果你希望在 Tradis 之外自行用 compose 运行，可参考：

```yaml
services:
  backup:
    image: offen/docker-volume-backup:latest
    restart: always
    env_file: ./backup.env
    volumes:
      - your_volume:/backup/your_volume:ro
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - /path/to/local_backups:/archive
volumes:
  your_volume:
```

