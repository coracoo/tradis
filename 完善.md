# 完善方案（AI 导航 / 卷备份 / 卷浏览器 / 高级部署）

## 1. AI 导航识别

### 1.1 为什么现在更容易输出 default/默认
- 之前提示词鼓励“从互联网搜索/自动分类”，模型在不确定时也会给出具体分类（但可信度不稳定）。
- 近期改为严格 JSON 协议后，如果提示词仍允许“无法判断就 default”，模型会更保守，尤其当输入上下文较少或已有 `category=默认` 时更倾向沿用。

### 1.2 当前收敛策略
- 仍然严格要求只输出 JSON（title/category/icon），但把“分类候选列表”与“可用 favicon 候选”作为上下文喂给模型，降低不确定性。
- category 统一使用中文；允许模型返回 `default`，后端会归一化为“未分类”。

### 1.3 图标策略（目标：可用、稳定、低频控风险）
- 识别时预先计算 `faviconIcon`（优先同源 `/favicon.ico|png|svg`，其次回退到 favicon 服务），并把该 URL 作为上下文提供给 AI。
- AI 只需在无更合适官方图标时直接输出 `faviconIcon`，否则输出它找到的 `http(s)` 图标 URL；实在没有则 `mdi-docker`。

## 2. 卷备份（docker-volume-backup）

### 2.1 现象：保存设置就频繁重建
- 根因是后端在每次保存设置时都会触发 `EnsureVolumeBackupContainer`，而旧实现无条件删除同名容器再创建，导致“只要保存就重建”。

### 2.2 目标行为
- 保存设置不应导致重建：容器存在且配置未变时应保持不动。
- 需要“手动重建”入口：当用户明确想拉取新镜像/刷新挂载/环境变量时再重建。

## 3. 卷浏览器（filebrowser 反代）

### 3.1 报错现象（text/html 作为 module script）
- 浏览器加载 JS 模块时收到 `Content-Type: text/html`，典型原因是静态资源请求被反代到错误路径，filebrowser 返回了 HTML fallback/错误页。

### 3.2 目标行为
- 反代必须保持与 filebrowser 的 `FB_BASEURL` 一致：浏览器请求的路径与上游实际接收路径需要匹配，否则静态资源会失配。

## 4. 高级部署（AppDeploy）

### 4.1 目标
- 在 AppDeploy 页新增“高级部署”标签页（位于“新手部署”和“使用教程”之间）。
- 高级部署提供左右布局：
  - 左：docker-compose.yml（可编辑）
  - 右：.env（可编辑）
- 部署时直接以用户最终编辑的 YAML 与 .env 为准执行部署。

### 4.2 相对路径与项目目录
- Docker Compose 的相对路径语义：通常以 compose 文件所在目录为基准解析（例如 `./data`）。
- 本项目部署目录在后端由 `GetProjectRoot()/projectName` 决定；并可通过环境变量 `PROJECT_ROOT` 开启“宿主机路径归一化”，将 bind mount 的相对路径归一到宿主机项目目录下。

## 需要你确认的细节（我会据此做最后收口）
1. 高级部署是否仅在“高级模式”开启时显示？关闭时是否完全隐藏，还是只读展示？
2. `category` 的“默认分类”你希望固定用哪个：`未分类` 还是 `其它`？（我现在使用 `未分类`）
3. favicon 优先级你希望是：
   - 优先同源 `http(s)://host:port/favicon.ico`（多数本地服务有效）
   - 其次第三方 favicon 服务
   - 最后 `mdi-docker`
   这个顺序是否符合你的预期？
4. 关于相对路径：你期望 `./data` 在部署后落到哪里？
   - A：以后端项目目录为基准（例如 `<projectRoot>/<projectName>/data`）
   - B：以宿主机 `PROJECT_ROOT` 为基准（例如 `<PROJECT_ROOT>/<projectName>/data`）
   - C：你有一个固定根目录（请给出），所有相对路径都归一到该根目录下
